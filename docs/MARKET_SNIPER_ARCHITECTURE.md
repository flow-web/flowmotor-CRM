# Market Sniper - Architecture Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         MARKET SNIPER ARCHITECTURE                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ USER INTERFACE                                                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚  Sourcing.jsx       â”‚              â”‚ VehicleCockpit.jsx  â”‚              â”‚
â”‚  â”‚  (New Vehicles)     â”‚              â”‚ (Existing Vehicles) â”‚              â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤              â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤              â”‚
â”‚  â”‚ â€¢ Vehicle Form      â”‚              â”‚ â€¢ Info Tab          â”‚              â”‚
â”‚  â”‚ â€¢ Calculator        â”‚              â”‚ â€¢ Sourcing Card     â”‚              â”‚
â”‚  â”‚                     â”‚              â”‚                     â”‚              â”‚
â”‚  â”‚ [Analyser MarchÃ©]ğŸ¯ â”‚              â”‚   [Analyser]ğŸ¯      â”‚              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚             â”‚                                    â”‚                          â”‚
â”‚             â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                          â”‚
â”‚             â””â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                                                     â”‚
â”‚                       â”‚                                                     â”‚
â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚              â”‚ MarketSniperModal.jsx                    â”‚                  â”‚
â”‚              â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                  â”‚
â”‚              â”‚ â€¢ Vehicle Summary Display                â”‚                  â”‚
â”‚              â”‚ â€¢ "Analyser le MarchÃ©" Button            â”‚                  â”‚
â”‚              â”‚ â€¢ Loading State (Loader2 spinner)        â”‚                  â”‚
â”‚              â”‚                                          â”‚                  â”‚
â”‚              â”‚ RESULTS DISPLAY:                         â”‚                  â”‚
â”‚              â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚                  â”‚
â”‚              â”‚ â”‚ Deal Quality Gauge (Visual Bar)    â”‚  â”‚                  â”‚
â”‚              â”‚ â”‚ â€¢ Green: Excellent (â‰¥20% below)    â”‚  â”‚                  â”‚
â”‚              â”‚ â”‚ â€¢ Lime: Good (10-19% below)        â”‚  â”‚                  â”‚
â”‚              â”‚ â”‚ â€¢ Orange: Neutral (0-9% below)     â”‚  â”‚                  â”‚
â”‚              â”‚ â”‚ â€¢ Red: Danger (at/above market)    â”‚  â”‚                  â”‚
â”‚              â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚                  â”‚
â”‚              â”‚                                          â”‚                  â”‚
â”‚              â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚                  â”‚
â”‚              â”‚ â”‚ Market Price Range                 â”‚  â”‚                  â”‚
â”‚              â”‚ â”‚ â€¢ Low Price                        â”‚  â”‚                  â”‚
â”‚              â”‚ â”‚ â€¢ Average Price (main)             â”‚  â”‚                  â”‚
â”‚              â”‚ â”‚ â€¢ High Price                       â”‚  â”‚                  â”‚
â”‚              â”‚ â”‚ â€¢ Visual slider with marker        â”‚  â”‚                  â”‚
â”‚              â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚                  â”‚
â”‚              â”‚                                          â”‚                  â”‚
â”‚              â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚                  â”‚
â”‚              â”‚ â”‚ Estimated Margin                   â”‚  â”‚                  â”‚
â”‚              â”‚ â”‚ â€¢ Potential Profit                 â”‚  â”‚                  â”‚
â”‚              â”‚ â”‚ â€¢ Margin Percentage                â”‚  â”‚                  â”‚
â”‚              â”‚ â”‚ â€¢ Warning if <10%                  â”‚  â”‚                  â”‚
â”‚              â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚                  â”‚
â”‚              â”‚                                          â”‚                  â”‚
â”‚              â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚                  â”‚
â”‚              â”‚ â”‚ Liquidity Score (1-10)             â”‚  â”‚                  â”‚
â”‚              â”‚ â”‚ â€¢ Progress bar visualization       â”‚  â”‚                  â”‚
â”‚              â”‚ â”‚ â€¢ Text interpretation              â”‚  â”‚                  â”‚
â”‚              â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚                  â”‚
â”‚              â”‚                                          â”‚                  â”‚
â”‚              â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚                  â”‚
â”‚              â”‚ â”‚ Market Notes                       â”‚  â”‚                  â”‚
â”‚              â”‚ â”‚ â€¢ AI commentary                    â”‚  â”‚                  â”‚
â”‚              â”‚ â”‚ â€¢ Confidence badge                 â”‚  â”‚                  â”‚
â”‚              â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚                  â”‚
â”‚              â”‚                                          â”‚                  â”‚
â”‚              â”‚ [Re-analyze] [Close]                     â”‚                  â”‚
â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â”‚                           â”‚                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â”‚ onClick("Analyser")
                            â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ BUSINESS LOGIC LAYER                                                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                            â”‚
â”‚  MarketSniperModal.jsx                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚ const handleAnalyze = async () => {                              â”‚     â”‚
â”‚  â”‚   setIsAnalyzing(true)                                           â”‚     â”‚
â”‚  â”‚                                                                   â”‚     â”‚
â”‚  â”‚   const vehicleData = {                                          â”‚     â”‚
â”‚  â”‚     year, brand, model, trim, mileage, fuel, transmission        â”‚     â”‚
â”‚  â”‚   }                                                               â”‚     â”‚
â”‚  â”‚                                                                   â”‚     â”‚
â”‚  â”‚   const result = await analyzeMarketPrice(vehicleData)  â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”   â”‚
â”‚  â”‚                                                                   â”‚ â”‚   â”‚
â”‚  â”‚   if (result) {                                                  â”‚ â”‚   â”‚
â”‚  â”‚     setAnalysis(result)                                          â”‚ â”‚   â”‚
â”‚  â”‚   }                                                               â”‚ â”‚   â”‚
â”‚  â”‚                                                                   â”‚ â”‚   â”‚
â”‚  â”‚   setIsAnalyzing(false)                                          â”‚ â”‚   â”‚
â”‚  â”‚ }                                                                 â”‚ â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   â”‚
â”‚                                                                         â”‚   â”‚
â”‚  const calculateDealMetrics = (marketData) => {                        â”‚   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   â”‚
â”‚  â”‚ // Market discount calculation                                   â”‚  â”‚   â”‚
â”‚  â”‚ marketDiscount = marketAvg - purchasePrice                       â”‚  â”‚   â”‚
â”‚  â”‚ marketDiscountPercent = (marketDiscount / marketAvg) Ã— 100       â”‚  â”‚   â”‚
â”‚  â”‚                                                                   â”‚  â”‚   â”‚
â”‚  â”‚ // Potential margin calculation                                  â”‚  â”‚   â”‚
â”‚  â”‚ potentialMargin = marketAvg - costPrice                          â”‚  â”‚   â”‚
â”‚  â”‚ potentialMarginPercent = (potentialMargin / marketAvg) Ã— 100     â”‚  â”‚   â”‚
â”‚  â”‚                                                                   â”‚  â”‚   â”‚
â”‚  â”‚ // Deal quality classification                                   â”‚  â”‚   â”‚
â”‚  â”‚ if (marketDiscountPercent >= 20) â†’ Excellent (green)             â”‚  â”‚   â”‚
â”‚  â”‚ if (marketDiscountPercent >= 10) â†’ Good (lime)                   â”‚  â”‚   â”‚
â”‚  â”‚ if (marketDiscountPercent >= 0)  â†’ Neutral (orange)              â”‚  â”‚   â”‚
â”‚  â”‚ else                             â†’ Danger (red)                  â”‚  â”‚   â”‚
â”‚  â”‚                                                                   â”‚  â”‚   â”‚
â”‚  â”‚ return { potentialMargin, marketDiscountPercent, dealQuality }   â”‚  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   â”‚
â”‚                                                                         â”‚   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”˜
                                                                          â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”
â”‚ AI INTEGRATION LAYER                                                    â”‚   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”¤
â”‚                                                                         â”‚   â”‚
â”‚  src/lib/gemini.js                                                      â”‚   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   â”‚
â”‚  â”‚ export async function analyzeMarketPrice(vehicleData) {  â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚  â”‚                                                           â”‚          â”‚
â”‚  â”‚   // 1. Validate API key                                 â”‚          â”‚
â”‚  â”‚   const client = getClient()                             â”‚          â”‚
â”‚  â”‚   if (!client) return null                               â”‚          â”‚
â”‚  â”‚                                                           â”‚          â”‚
â”‚  â”‚   // 2. Format vehicle data for prompt                   â”‚          â”‚
â”‚  â”‚   const fields = [                                        â”‚          â”‚
â”‚  â”‚     `AnnÃ©e: ${year}`,                                     â”‚          â”‚
â”‚  â”‚     `Marque: ${brand}`,                                   â”‚          â”‚
â”‚  â”‚     `ModÃ¨le: ${model}`,                                   â”‚          â”‚
â”‚  â”‚     `KilomÃ©trage: ${mileage} km`,                         â”‚          â”‚
â”‚  â”‚     ...                                                   â”‚          â”‚
â”‚  â”‚   ].join('\n')                                            â”‚          â”‚
â”‚  â”‚                                                           â”‚          â”‚
â”‚  â”‚   // 3. Call Gemini API                                  â”‚          â”‚
â”‚  â”‚   const model = client.getGenerativeModel({              â”‚          â”‚
â”‚  â”‚     model: 'gemini-2.0-flash'                            â”‚          â”‚
â”‚  â”‚   })                                                      â”‚          â”‚
â”‚  â”‚                                                           â”‚          â”‚
â”‚  â”‚   const result = await model.generateContent([  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚     { text: MARKET_PRICE_SYSTEM_PROMPT },                â”‚     â”‚    â”‚
â”‚  â”‚     { text: `Voici les donnÃ©es:\n\n${fields}` }          â”‚     â”‚    â”‚
â”‚  â”‚   ])                                                      â”‚     â”‚    â”‚
â”‚  â”‚                                                           â”‚     â”‚    â”‚
â”‚  â”‚   // 4. Parse and validate response                      â”‚     â”‚    â”‚
â”‚  â”‚   const response = result.response.text()                â”‚     â”‚    â”‚
â”‚  â”‚   const cleaned = response                               â”‚     â”‚    â”‚
â”‚  â”‚     .replace(/^```json\s*/, '')  // Strip markdown       â”‚     â”‚    â”‚
â”‚  â”‚     .replace(/\s*```$/, '')                              â”‚     â”‚    â”‚
â”‚  â”‚     .trim()                                               â”‚     â”‚    â”‚
â”‚  â”‚                                                           â”‚     â”‚    â”‚
â”‚  â”‚   const parsed = JSON.parse(cleaned)                     â”‚     â”‚    â”‚
â”‚  â”‚                                                           â”‚     â”‚    â”‚
â”‚  â”‚   // 5. Validate structure                               â”‚     â”‚    â”‚
â”‚  â”‚   if (!parsed.low_price || !parsed.average_price) {      â”‚     â”‚    â”‚
â”‚  â”‚     return null                                           â”‚     â”‚    â”‚
â”‚  â”‚   }                                                       â”‚     â”‚    â”‚
â”‚  â”‚                                                           â”‚     â”‚    â”‚
â”‚  â”‚   // 6. Transform snake_case â†’ camelCase                 â”‚     â”‚    â”‚
â”‚  â”‚   return {                                                â”‚     â”‚    â”‚
â”‚  â”‚     lowPrice: parsed.low_price,                          â”‚     â”‚    â”‚
â”‚  â”‚     highPrice: parsed.high_price,                        â”‚     â”‚    â”‚
â”‚  â”‚     averagePrice: parsed.average_price,                  â”‚     â”‚    â”‚
â”‚  â”‚     liquidityScore: parsed.liquidity_score,              â”‚     â”‚    â”‚
â”‚  â”‚     marketNotes: parsed.market_notes,                    â”‚     â”‚    â”‚
â”‚  â”‚     confidence: parsed.confidence                        â”‚     â”‚    â”‚
â”‚  â”‚   }                                                       â”‚     â”‚    â”‚
â”‚  â”‚ }                                                         â”‚     â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                              â”‚          â”‚
â”‚  MARKET_PRICE_SYSTEM_PROMPT                                 â”‚          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ Tu es un expert du marchÃ© automobile franÃ§ais.                    â”‚ â”‚
â”‚  â”‚                                                                    â”‚ â”‚
â”‚  â”‚ IMPORTANT: Sois CONSERVATEUR et PESSIMISTE dans tes estimations.  â”‚ â”‚
â”‚  â”‚                                                                    â”‚ â”‚
â”‚  â”‚ Retourne UNIQUEMENT un objet JSON strict:                         â”‚ â”‚
â”‚  â”‚ {                                                                  â”‚ â”‚
â”‚  â”‚   "low_price": 38000,                                              â”‚ â”‚
â”‚  â”‚   "high_price": 45000,                                             â”‚ â”‚
â”‚  â”‚   "average_price": 41500,                                          â”‚ â”‚
â”‚  â”‚   "liquidity_score": 7,                                            â”‚ â”‚
â”‚  â”‚   "market_notes": "Forte demande...",                              â”‚ â”‚
â”‚  â”‚   "confidence": "medium"                                           â”‚ â”‚
â”‚  â”‚ }                                                                  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”˜
                                                                          â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”
â”‚ EXTERNAL API                                                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  Google Gemini AI (gemini-2.0-flash)                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                                                                       â”‚  â”‚
â”‚  â”‚  KNOWLEDGE BASE:                                                      â”‚  â”‚
â”‚  â”‚  â€¢ LeBoncoin pricing data                                             â”‚  â”‚
â”‚  â”‚  â€¢ La Centrale market trends                                          â”‚  â”‚
â”‚  â”‚  â€¢ AutoScout24 European prices                                        â”‚  â”‚
â”‚  â”‚  â€¢ Seasonal demand patterns                                           â”‚  â”‚
â”‚  â”‚  â€¢ Regional price variations (France)                                 â”‚  â”‚
â”‚  â”‚  â€¢ Mileage depreciation curves                                        â”‚  â”‚
â”‚  â”‚  â€¢ Brand/model popularity scores                                      â”‚  â”‚
â”‚  â”‚                                                                       â”‚  â”‚
â”‚  â”‚  ANALYSIS ENGINE:                                                     â”‚  â”‚
â”‚  â”‚  1. Parse vehicle specifications                                      â”‚  â”‚
â”‚  â”‚  2. Search internal knowledge base                                    â”‚  â”‚
â”‚  â”‚  3. Apply depreciation models                                         â”‚  â”‚
â”‚  â”‚  4. Factor in mileage, age, condition                                 â”‚  â”‚
â”‚  â”‚  5. Consider market demand (liquidity)                                â”‚  â”‚
â”‚  â”‚  6. Apply CONSERVATIVE bias (-10% safety margin)                      â”‚  â”‚
â”‚  â”‚  7. Generate price range (low/avg/high)                               â”‚  â”‚
â”‚  â”‚  8. Estimate liquidity score (1-10)                                   â”‚  â”‚
â”‚  â”‚  9. Write market commentary                                           â”‚  â”‚
â”‚  â”‚  10. Assess confidence level                                          â”‚  â”‚
â”‚  â”‚                                                                       â”‚  â”‚
â”‚  â”‚  OUTPUT:                                                              â”‚  â”‚
â”‚  â”‚  {                                                                    â”‚  â”‚
â”‚  â”‚    "low_price": 85000,     // Conservative floor                     â”‚  â”‚
â”‚  â”‚    "high_price": 95000,    // Optimistic ceiling                     â”‚  â”‚
â”‚  â”‚    "average_price": 90000, // Realistic mid-point                    â”‚  â”‚
â”‚  â”‚    "liquidity_score": 8,   // Fast seller (1-10)                     â”‚  â”‚
â”‚  â”‚    "market_notes": "Forte demande pour ce modÃ¨le...",                â”‚  â”‚
â”‚  â”‚    "confidence": "high"    // Data availability                      â”‚  â”‚
â”‚  â”‚  }                                                                    â”‚  â”‚
â”‚  â”‚                                                                       â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                             â”‚
â”‚  API CONFIGURATION:                                                         â”‚
â”‚  â€¢ Endpoint: https://generativelanguage.googleapis.com/v1beta/             â”‚
â”‚  â€¢ Model: gemini-2.0-flash                                                  â”‚
â”‚  â€¢ Auth: API key (VITE_GEMINI_API_KEY)                                      â”‚
â”‚  â€¢ Rate Limit: 1,500 requests/day (free tier)                              â”‚
â”‚  â€¢ Cost: ~â‚¬0.00007 per request                                              â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ DATA FLOW                                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

User Action:
  Click "Analyser le MarchÃ©" ğŸ¯
         â”‚
         â–¼
  Validate Input
    (brand, model, year required)
         â”‚
         â–¼
  Open MarketSniperModal
    â€¢ Show vehicle summary
    â€¢ Display "Analyser" button
         â”‚
         â–¼
  User clicks "Analyser"
         â”‚
         â–¼
  setIsAnalyzing(true)
  Show Loader2 spinner
         â”‚
         â–¼
  Call analyzeMarketPrice(vehicleData)
         â”‚
         â”œâ”€â–º Validate Gemini API key
         â”‚   (return null if missing)
         â”‚
         â”œâ”€â–º Format vehicle data as text
         â”‚   "AnnÃ©e: 2022, Marque: Audi, ..."
         â”‚
         â”œâ”€â–º Send to Gemini API
         â”‚   POST https://generativelanguage.googleapis.com/v1beta/...
         â”‚   Body: { prompt: SYSTEM_PROMPT + vehicle data }
         â”‚
         â”œâ”€â–º Wait for response (1-3 seconds)
         â”‚
         â”œâ”€â–º Parse JSON response
         â”‚   â€¢ Strip markdown fences
         â”‚   â€¢ JSON.parse(cleaned)
         â”‚   â€¢ Validate structure
         â”‚
         â”œâ”€â–º Transform snake_case â†’ camelCase
         â”‚   low_price â†’ lowPrice, etc.
         â”‚
         â””â”€â–º Return { lowPrice, averagePrice, ... }
                   â”‚
                   â–¼
            setAnalysis(result)
            setIsAnalyzing(false)
                   â”‚
                   â–¼
            calculateDealMetrics(result)
              â€¢ Market discount %
              â€¢ Potential margin
              â€¢ Deal quality (Green/Orange/Red)
                   â”‚
                   â–¼
            Render Results UI
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚ âœ… Excellente affaire          â”‚
              â”‚ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘ 89% quality        â”‚
              â”‚                                 â”‚
              â”‚ Prix marchÃ©: â‚¬90,000            â”‚
              â”‚ Votre prix: â‚¬75,000             â”‚
              â”‚ Ã‰conomie: -â‚¬15,000 (-17%)       â”‚
              â”‚                                 â”‚
              â”‚ Marge estimÃ©e: â‚¬13,000 (14.4%)  â”‚
              â”‚ LiquiditÃ©: 8/10 â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘      â”‚
              â”‚                                 â”‚
              â”‚ "Forte demande, kilomÃ©trage OK" â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
                   â–¼
            User makes decision:
              â€¢ BUY (green) â†’ Proceed
              â€¢ NEGOTIATE (orange) â†’ Contact seller
              â€¢ PASS (red) â†’ Find another car

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ERROR HANDLING                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

  Missing API Key
    â”œâ”€â–º isGeminiConfigured() â†’ false
    â”œâ”€â–º Button disabled
    â””â”€â–º Warning: "ClÃ© API non configurÃ©e"

  Network Error
    â”œâ”€â–º Gemini API timeout (>10s)
    â”œâ”€â–º catch (err) â†’ log to console
    â”œâ”€â–º toast.error("Impossible d'analyser...")
    â””â”€â–º User can retry

  Invalid Response
    â”œâ”€â–º Gemini returns non-JSON
    â”œâ”€â–º JSON.parse() fails
    â”œâ”€â–º Return null (graceful)
    â””â”€â–º toast.error("RÃ©essayez")

  Rate Limit Exceeded
    â”œâ”€â–º Gemini returns 429 error
    â”œâ”€â–º Show toast: "Limite atteinte, attendez 1 min"
    â””â”€â–º Disable button for 60s

  Incomplete Data
    â”œâ”€â–º Missing required fields (brand/model/year)
    â”œâ”€â–º Validation before API call
    â””â”€â–º toast.error("Renseignez marque et modÃ¨le")

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ DEPLOYMENT                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

  Development:
    .env
    â””â”€â–º VITE_GEMINI_API_KEY=AIza...

  Production:
    Vercel/Netlify Environment Variables
    â””â”€â–º VITE_GEMINI_API_KEY=AIza... (secret)

  Security:
    âš ï¸ Client-side API key (visible in browser)
    âœ… Free tier limits abuse (1,500/day max)
    ğŸ”’ Future: Move to Edge Function (Vercel/Cloudflare)
       â†’ Server-side key hidden
       â†’ Better rate limiting
       â†’ Request logging

  Monitoring:
    â€¢ Google AI Studio Dashboard
    â€¢ Track API usage (requests/day)
    â€¢ Monitor success/failure rates
    â€¢ Log user feedback on accuracy
```

**Legend**:
- `â”€â–º` : Data flow
- `â”Œâ”€â”` : Component boundary
- `ğŸ¯` : User interaction
- `âœ…` : Success state
- `âš ï¸` : Warning/caution
- `âŒ` : Error/failure
