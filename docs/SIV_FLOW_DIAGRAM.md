# SIV API Integration - Flow Diagram

## User Journey Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ATELIER PAGE - /atelier                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Step 1: License Plate Input                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  F â”‚ [  A  A  -  1  2  3  -  B  B  ] â”‚ 69               â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                  â”‚
â”‚  User types: "aa123bb" â†’ Auto-format: "AA-123-BB"              â”‚
â”‚  Visual feedback: Green border (valid) / Red border (invalid)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Step 2: Validation (Client-Side)                               â”‚
â”‚  validatePlate("AA-123-BB")                                      â”‚
â”‚    â”œâ”€ Remove spaces/dashes â†’ "AA123BB"                          â”‚
â”‚    â”œâ”€ Convert to uppercase â†’ "AA123BB"                          â”‚
â”‚    â”œâ”€ Regex check: /^[A-Z]{2}[0-9]{3}[A-Z]{2}$/                 â”‚
â”‚    â””â”€ Normalize: "AA-123-BB" âœ“                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  User clicks CTA   â”‚
                    â”‚ "Estimer ma voiture"â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Step 3: API Mode Selection                                     â”‚
â”‚                                                                  â”‚
â”‚  Check: VITE_SIV_API_KEY environment variable                   â”‚
â”‚    â”‚                                                             â”‚
â”‚    â”œâ”€ IF SET â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                  â”‚
â”‚    â”‚                          â–¼                                  â”‚
â”‚    â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”‚
â”‚    â”‚              â”‚   REAL API MODE        â”‚                    â”‚
â”‚    â”‚              â”‚  callRealAPI(plate)    â”‚                    â”‚
â”‚    â”‚              â”‚                        â”‚                    â”‚
â”‚    â”‚              â”‚  1. Fetch API          â”‚                    â”‚
â”‚    â”‚              â”‚  2. Auth header        â”‚                    â”‚
â”‚    â”‚              â”‚  3. Handle errors:     â”‚                    â”‚
â”‚    â”‚              â”‚     - 404 Not found    â”‚                    â”‚
â”‚    â”‚              â”‚     - 429 Rate limit   â”‚                    â”‚
â”‚    â”‚              â”‚     - Network error    â”‚                    â”‚
â”‚    â”‚              â”‚  4. Transform response â”‚                    â”‚
â”‚    â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚
â”‚    â”‚                           â”‚                                 â”‚
â”‚    â””â”€ IF NOT SET â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”                         â”‚
â”‚                                â”‚      â–¼                          â”‚
â”‚                                â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚                                â”‚  â”‚   MOCK MODE            â”‚    â”‚
â”‚                                â”‚  â”‚  getMockVehicleData()  â”‚    â”‚
â”‚                                â”‚  â”‚                        â”‚    â”‚
â”‚                                â”‚  â”‚  1. Check test DB      â”‚    â”‚
â”‚                                â”‚  â”‚  2. Generate random    â”‚    â”‚
â”‚                                â”‚  â”‚  3. Delay 800ms        â”‚    â”‚
â”‚                                â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                â”‚               â”‚                 â”‚
â”‚                                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Step 4: Response Handling                                      â”‚
â”‚                                                                  â”‚
â”‚  SUCCESS PATH                    ERROR PATH                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ {                         â”‚   â”‚ {                        â”‚    â”‚
â”‚  â”‚   success: true,          â”‚   â”‚   success: false,        â”‚    â”‚
â”‚  â”‚   data: {                 â”‚   â”‚   error: "Message..."    â”‚    â”‚
â”‚  â”‚     brand: "Renault",     â”‚   â”‚ }                        â”‚    â”‚
â”‚  â”‚     model: "Clio V",      â”‚   â”‚                          â”‚    â”‚
â”‚  â”‚     year: 2020,           â”‚   â”‚ Display red alert:       â”‚    â”‚
â”‚  â”‚     mileage: 45000,       â”‚   â”‚ "VÃ©hicule non trouvÃ©,    â”‚    â”‚
â”‚  â”‚     ...                   â”‚   â”‚  veuillez remplir        â”‚    â”‚
â”‚  â”‚   }                       â”‚   â”‚  manuellement"           â”‚    â”‚
â”‚  â”‚ }                         â”‚   â”‚                          â”‚    â”‚
â”‚  â”‚                           â”‚   â”‚ User can:                â”‚    â”‚
â”‚  â”‚ Display green badge:      â”‚   â”‚ - Retry                  â”‚    â”‚
â”‚  â”‚ âœ“ VÃ©hicule trouvÃ©         â”‚   â”‚ - Fill manually          â”‚    â”‚
â”‚  â”‚ Renault Clio V - 2020     â”‚   â”‚                          â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚               â”‚                                                   â”‚
â”‚               â–¼                                                   â”‚
â”‚  Auto-fill wizard fields:                                        â”‚
â”‚  - selectedBrand = "Renault"                                     â”‚
â”‚  - model = "Clio V"                                              â”‚
â”‚  - year = "2020"                                                 â”‚
â”‚  - mileage = "10000-30000" (estimated)                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Step 5: Wizard Transition (1.5s delay)                         â”‚
â”‚                                                                  â”‚
â”‚  plateSubmitted = true                                           â”‚
â”‚  showWizard = true                                               â”‚
â”‚                                                                  â”‚
â”‚  Display: "VÃ©hicule identifiÃ© âœ“"                                â”‚
â”‚           "Redirection vers le formulaire..."                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Step 6: Wizard Steps (Pre-filled)                              â”‚
â”‚                                                                  â”‚
â”‚  STEP 1: Brand Selection                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚ [Audi] [BMW] [Mercedes] [ğŸ”˜ Renault] [Toyota]  â”‚           â”‚
â”‚  â”‚ ... (pre-selected from API)                      â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚                                                                  â”‚
â”‚  STEP 2: Model, Year, Mileage                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚ ModÃ¨le: [Clio V]  (pre-filled)                   â”‚           â”‚
â”‚  â”‚ AnnÃ©e:  [2020 â–¼]  (pre-selected)                 â”‚           â”‚
â”‚  â”‚ KM:     [ğŸ”˜ 10-30k] (estimated from mileage)     â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚                                                                  â”‚
â”‚  STEP 3: Contact Info                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚ Nom:   [____]                                     â”‚           â”‚
â”‚  â”‚ Email: [____]                                     â”‚           â”‚
â”‚  â”‚ Tel:   [____] (optionnel)                         â”‚           â”‚
â”‚  â”‚                                                    â”‚           â”‚
â”‚  â”‚ RÃ©capitulatif:                                    â”‚           â”‚
â”‚  â”‚ Renault Clio V                                    â”‚           â”‚
â”‚  â”‚ AnnÃ©e 2020 - 10 000 - 30 000 km                   â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Step 7: Lead Submission                                        â”‚
â”‚                                                                  â”‚
â”‚  createLead({                                                    â”‚
â”‚    name: "Jean Dupont",                                          â”‚
â”‚    email: "jean@example.com",                                    â”‚
â”‚    phone: "0612345678",                                          â”‚
â”‚    subject: "reprise",                                           â”‚
â”‚    message: "Marque : Renault\nModÃ¨le : Clio V\n...",           â”‚
â”‚    source: "estimation_flash"                                    â”‚
â”‚  })                                                              â”‚
â”‚                                                                  â”‚
â”‚  â†’ Saved to Supabase `leads` table                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Step 8: Success Screen                                         â”‚
â”‚                                                                  â”‚
â”‚  âœ“ Demande envoyÃ©e !                                            â”‚
â”‚  Notre Ã©quipe vous contactera sous 24h avec une estimation      â”‚
â”‚  personnalisÃ©e pour votre Renault Clio V.                       â”‚
â”‚                                                                  â”‚
â”‚  [Nouvelle estimation]                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Component Structure

```
Atelier.jsx
â”œâ”€ State Management
â”‚  â”œâ”€ plateValue: string
â”‚  â”œâ”€ plateLoading: boolean
â”‚  â”œâ”€ plateResult: {success, data?, error?}
â”‚  â”œâ”€ showWizard: boolean
â”‚  â”œâ”€ wizardStep: 0|1|2
â”‚  â””â”€ [vehicle fields: brand, model, year, mileage]
â”‚
â”œâ”€ LicensePlateInput Component
â”‚  â”œâ”€ Props: value, onChange, onSubmit, isValid
â”‚  â”œâ”€ Auto-format on type
â”‚  â”œâ”€ Visual validation (border color)
â”‚  â””â”€ Enter key support
â”‚
â”œâ”€ handlePlateSubmit() - Async Handler
â”‚  â”œâ”€ 1. validatePlate()
â”‚  â”œâ”€ 2. setPlateLoading(true)
â”‚  â”œâ”€ 3. getVehicleByPlate() â†’ SIV API
â”‚  â”œâ”€ 4. Auto-fill wizard fields
â”‚  â””â”€ 5. Transition to wizard
â”‚
â””â”€ Wizard Steps (renderStep1, renderStep2, renderStep3)
   â””â”€ Pre-filled from API data
```

## Data Flow Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   User Input â”‚
â”‚  "AA-123-BB" â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  src/lib/api/siv.js      â”‚
â”‚  â”œâ”€ validatePlate()      â”‚
â”‚  â”‚   â†’ {valid, normalized}
â”‚  â”‚                        â”‚
â”‚  â”œâ”€ getVehicleByPlate()  â”‚
â”‚  â”‚   â”œâ”€ Check API_KEY    â”‚
â”‚  â”‚   â”œâ”€ Real: callRealAPI()
â”‚  â”‚   â””â”€ Mock: getMockData()
â”‚  â”‚                        â”‚
â”‚  â””â”€ Response:            â”‚
â”‚      {success, data/error}
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Atelier.jsx               â”‚
â”‚  â”œâ”€ setPlateResult()       â”‚
â”‚  â”œâ”€ Auto-fill:             â”‚
â”‚  â”‚   - setSelectedBrand()  â”‚
â”‚  â”‚   - setModel()          â”‚
â”‚  â”‚   - setYear()           â”‚
â”‚  â”‚   - setMileage()        â”‚
â”‚  â”‚                         â”‚
â”‚  â””â”€ Transition:            â”‚
â”‚      showWizard = true     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Wizard Render           â”‚
â”‚  (Pre-filled UI)         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Mock vs Real API Decision Tree

```
User submits plate
        â”‚
        â–¼
    Check env
        â”‚
        â”œâ”€â”€â”€â”€â”€â”€â”€ VITE_SIV_API_KEY exists? â”€â”€â”€â”€ YES â”€â”€â”€â”
        â”‚                                              â”‚
        NO                                             â”‚
        â”‚                                              â”‚
        â–¼                                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  MOCK MODE     â”‚                          â”‚  REAL API MODE   â”‚
â”‚                â”‚                          â”‚                  â”‚
â”‚  Advantages:   â”‚                          â”‚  Advantages:     â”‚
â”‚  - Free        â”‚                          â”‚  - Accurate data â”‚
â”‚  - Instant     â”‚                          â”‚  - Up-to-date    â”‚
â”‚  - Predictable â”‚                          â”‚  - Real VIN      â”‚
â”‚  - Demo-ready  â”‚                          â”‚                  â”‚
â”‚                â”‚                          â”‚  Disadvantages:  â”‚
â”‚  Use cases:    â”‚                          â”‚  - Costs money   â”‚
â”‚  - Development â”‚                          â”‚  - Rate limits   â”‚
â”‚  - Testing     â”‚                          â”‚  - Network dep.  â”‚
â”‚  - Demos       â”‚                          â”‚  - Key exposed   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                                              â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â–¼
                    Common response
                    {success, data?}
                           â”‚
                           â–¼
                      Same UI flow
```

## Security Flow (Future Enhancement)

```
Current (Client-Side):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Browser  â”‚â”€â”€â”€â”€â–¶â”‚ VITE_API_KEYâ”‚â”€â”€â”€â”€â–¶â”‚ SIV API      â”‚
â”‚ (Public) â”‚     â”‚ (Exposed)   â”‚     â”‚ (Third-party)â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      âš  Key visible in Network tab

Recommended (Server-Side):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Browser  â”‚â”€â”€â”€â”€â–¶â”‚ Supabase Edge   â”‚â”€â”€â”€â”€â–¶â”‚ SIV API  â”‚
â”‚ (Public) â”‚     â”‚ Function        â”‚     â”‚          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚ (Server secret) â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      âœ“ Key protected server-side
```
